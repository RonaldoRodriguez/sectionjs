<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Demo SectionJS</title>
    <style>
        .section-container {
            margin: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        .article {
            margin: 15px 0;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
        }
        
        .pagination {
            margin: 20px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 5px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .stats {
            padding: 10px;
            background: #e9f5ff;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        button {
            padding: 8px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <!-- Sección 1: Datos desde API externa -->
    <section id="postsSection"
             class="section-container"
             data-section="https://jsonplaceholder.typicode.com/posts"
             data-limit="5"
             data-order-by="id"
             data-order="desc"
             data-default-page="1">
        
        <!-- Plantilla para cada artículo -->
        <div data-section-render class="article">
            <h2>{{ id }}. {{ title }}</h2>
            <p>{{ body }}</p>
            <small>Usuario ID: {{ userId }}</small>
        </div>

        <!-- Elementos estáticos -->
        <div data-section-static>
            <div class="pagination">
                <button data-action="prev">Anterior</button>
                <span data-action="info">Página {{ currentPage }} de {{ totalPages }}</span>
                <button data-action="next">Siguiente</button>
            </div>
            
            <div class="stats" data-action="info">
                Mostrando del {{ firstItemIndex }} al {{ lastItemIndex }} de {{ itemsTotal }} artículos
            </div>
        </div>
    </section>

    <!-- Sección 2: Datos inline -->
    <section id="localSection"
             class="section-container"
             data-section='[
                 {"nombre": "Alice", "edad": 28, "puesto": "Desarrollador"},
                 {"nombre": "Bob", "edad": 32, "puesto": "Diseñador"},
                 {"nombre": "Charlie", "edad": 25, "puesto": "Gerente"}
             ]'
             data-limit="2"
             data-by="edad"
             data-order="asc">
        
        <!-- Plantilla para cada elemento -->
        <div data-section-render class="article">
            <h3>{{ nombre }}</h3>
            <p>Edad: {{ edad }}</p>
            <p>Puesto: {{ puesto }}</p>
        </div>

        <!-- Controles externos -->
        <div data-section-static class="pagination">
            <button data-action="prev">Anterior</button>
            <span data-action="info">Página {{ currentPage }} de {{ totalPages }}</span>
            <button data-action="next">Siguiente</button>
        </div>
    </section>

    <!-- Controles globales -->
    <div class="section-container">
        <h3>Controles de Paginación</h3>
        
        <div>
            <label>Elementos por página: </label>
            <input type="number" id="itemsPerPage" value="5" min="1" style="width: 60px;">
            <button onclick="updateItemsPerPage()">Actualizar</button>
        </div>
        
        <div style="margin-top: 10px;">
            <button onclick="refreshPosts()">Recargar Datos</button>
        </div>
    </div>

    <script src="../dist/sectionjs.min.js"></script>
    <script>
        // Inicialización
        SectionJS.initAll().then(() => {
            // Eventos para la primera sección
            const postsSection = SectionJS.instances.find(i => i.name === 'postsSection');
            
            postsSection.onRendered(detail => {
                console.log('Posts renderizados:', detail.renderedElements);
            });
            
            postsSection.onError((error, message) => {
                console.error('Error en posts:', message, error);
            });
            
            // Ejemplo de solicitud de datos
            postsSection.onDataRequest('post', async (query) => {
                return postsSection.data?.find(p => p.id === query.id);
            });
        });

        // Funciones de control
        function updateItemsPerPage() {
            const newLimit = document.getElementById('itemsPerPage').value;
            SectionJS.apply('postsSection', 'data-limit', newLimit);
        }

        function refreshPosts() {
            SectionJS.instances.forEach(instance => {
                instance.setAttribute('data-section', instance.dataSourceURL);
            });
        }

        // Ejemplo de uso de requestData
        async function getPostById(id) {
            try {
                const post = await SectionJS.instances
                    .find(i => i.name === 'postsSection')
                    .requestData('post', { id: id });
                
                console.log('Post solicitado:', post);
            } catch (error) {
                console.error('Error solicitando post:', error);
            }
        }
    </script>
</body>
</html>